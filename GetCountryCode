CREATE PROCEDURE [dbo].[GetCountryCode]
(    
 @CountryId Varchar(11)=Null    
 ) 
As 
BEGIN
SET NOCOUNT ON 
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
BEGIN TRY
BEGIN TRAN
DECLARE @ErrorMessage VARCHAR(8000);
DECLARE @ErrorSeverity INT;
DECLARE @ErrorState INT;
if(@CountryId ='')
set @CountryId=null;
Select Country, Code as Code,CountryId as CountryId,0 as Rank from CountryCode WITH (NOLOCK)
 WHERE CountryId=COALESCE(@CountryId,CountryId)  group by Country,Code,CountryId

COMMIT TRAN
END TRY

BEGIN CATCH
ROLLBACK TRAN
IF (@@ERROR <> 0)
BEGIN	
SELECT
@ErrorMessage =ERROR_MESSAGE(),
@ErrorSeverity = ERROR_SEVERITY(),
@ErrorState = ERROR_STATE();
RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)
END
END CATCH	

RETURN 1 
SET NOCOUNT OFF;	
END
