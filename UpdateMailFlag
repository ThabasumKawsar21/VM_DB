CREATE PROCEDURE [dbo].[UpdateMailFlag]
	-- Add the parameters for the stored procedure here
	@RequestID Varchar(MAX)

	 
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	BEGIN TRY
	BEGIN TRAN
DECLARE @ErrorMessage VARCHAR(8000);
DECLARE @ErrorSeverity INT;
DECLARE @ErrorState INT;
DECLARE @PrefID INT = 0;
DECLARE @BulkUpload INT = 0	

Select @PrefID = ParentreferenceID,@BulkUpload = BulkUpload from VisitorRequest where RequestID = @RequestID
if len(@RequestID)<1 or @RequestID is null  return 

IF @BulkUpload = 1

update VisitorRequest SET BJMailFlag = 1 where (RequestID in (@RequestID) OR ParentreferenceID IN (@PrefID))

ELSE

update VisitorRequest SET BJMailFlag = 1 where (RequestID in (@RequestID)) 


	COMMIT TRAN
	END TRY
    
	BEGIN CATCH
	ROLLBACK TRAN
	IF (@@ERROR <> 0)
BEGIN	
SELECT
@ErrorMessage =ERROR_MESSAGE(),
@ErrorSeverity = ERROR_SEVERITY(),
@ErrorState = ERROR_STATE();
RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)
END
	END CATCH

   
END
