CREATE PROCEDURE GetVisitorSchedule
@visitDetailsId varchar(50)
AS
BEGIN
SET NOCOUNT ON;

BEGIN TRY

BEGIN TRAN
DECLARE @ErrorMessage VARCHAR(8000);
DECLARE @ErrorSeverity INT;
DECLARE @ErrorState INT;

DECLARE @ReqID INT;
SET @ReqID = (select top(1) RequestID from VisitDetails WITH (NOLOCK) where VisitDetailsID = @visitDetailsId)
select CONVERT(VARCHAR(10), det.Date, 103)as Date,req.FromTime,req.ToTime from visitdetails det join VisitorRequest req on det.RequestID=req.RequestID where det.RequestID=@ReqID	

COMMIT TRAN
END TRY

BEGIN CATCH
ROLLBACK TRAN
IF (@@ERROR <> 0)
BEGIN	
SELECT
@ErrorMessage =ERROR_MESSAGE(),
@ErrorSeverity = ERROR_SEVERITY(),
@ErrorState = ERROR_STATE();
RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)
END
END CATCH	

END
