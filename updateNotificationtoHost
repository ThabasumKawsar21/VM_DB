CREATE PROCEDURE [dbo].[updateNotificationtoHost]   
 -- Add the parameters for the stored procedure here  

 @ParentRefernceID INT,
 @NotifiedBy int

AS  
BEGIN
SET NOCOUNT ON 
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
BEGIN TRY
BEGIN TRAN
DECLARE @ErrorMessage VARCHAR(8000);
DECLARE @ErrorSeverity INT;
DECLARE @ErrorState INT;

  
    -- Insert statements for procedure here  

 
 update ClientRequestDetails set NotificationToHost=1, Notifiedby=@NotifiedBy,NotifiedTime=GETDATE()
  WHERE RequestID in 
 (select requestid from VisitorRequest where ParentReferenceId=@ParentRefernceID)

 UPDATE VisitDetails 
			SET BadgeStatus='Host Notified', LastUpdatedDate=GETDATE()
			where 
			--DATE = convert (date, getdate()) and 
 RequestID in (select requestid from visitorrequest where parentreferenceid=@ParentRefernceID)


COMMIT TRAN
END TRY

BEGIN CATCH
ROLLBACK TRAN
IF (@@ERROR <> 0)
BEGIN	
SELECT
@ErrorMessage =ERROR_MESSAGE(),
@ErrorSeverity = ERROR_SEVERITY(),
@ErrorState = ERROR_STATE();
RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)
END
END CATCH	

RETURN 1 
SET NOCOUNT OFF;	
END
